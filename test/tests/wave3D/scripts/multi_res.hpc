#PBS -N MultiRes3D
#PBS -l select=16:ncpus=48:mpiprocs=48
#PBS -l place=scatter:excl
#PBS -l walltime=12:40:00
#PBS -j oe
#PBS -P ne_ldrd
cd $PBS_O_WORKDIR

rm -r measurement
cp -r synthetic measurement
cp inputs/GrGaussian.i inputs/GrMesh.i

../../../isopod-opt -i inputs/GrMesh.i grid_size=3

cp GrMesh3.e inputs/GrMesh.e
cp measurement/measurements1_2.csv measurement/measurements.csv
mpirun ../../../isopod-opt -i invert.i maxiter=10
mv inversion/GrMesh.e inversion/GrMesh3.e
mv inversion/GrMesh_OptimizationInfo_0001.csv inversion/Convergence3.csv
mv inversion/GrMesh_OptimizationReporter_0001.csv inversion/GrValues3.csv

../../../isopod-opt -i refine.i coarse_grid=3 fine_grid=6
cp inputs/GrMesh6.e inputs/GrMesh.e

cp measurement/measurements1_4.csv measurement/measurements.csv
mpirun ../../../isopod-opt -i invert.i maxiter=10
mv inversion/GrMesh.e inversion/GrMesh6.e
mv inversion/GrMesh_OptimizationInfo_0001.csv inversion/Convergence6.csv
mv inversion/GrMesh_OptimizationReporter_0001.csv inversion/GrValues6.csv

../../../isopod-opt -i refine.i coarse_grid=6 fine_grid=12
cp inputs/GrMesh12.e inputs/GrMesh.e

cp measurement/measurements1_8.csv measurement/measurements.csv
mpirun ../../../isopod-opt -i invert.i maxiter=10
mv inversion/GrMesh.e inversion/GrMesh12.e
mv inversion/GrMesh_OptimizationInfo_0001.csv inversion/Convergence6.csv
mv inversion/GrMesh_OptimizationReporter_0001.csv inversion/GrValues6.csv

../../../isopod-opt -i refine.i coarse_grid=12 fine_grid=24

rm inputs/GrMesh.e
rm inputs/GrMesh.i
